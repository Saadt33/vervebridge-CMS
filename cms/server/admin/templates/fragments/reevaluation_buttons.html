{% macro ReevaluationButtons(next_page,
                             submission_id=None,
                             dataset_id=None,
                             participation_id=None,
                             contest_id=None) %}
{# Render reevaluation buttons for the given filters.

   These are the possible configuration of not-none arguments received:
   - submission_id and dataset_id: the submission is reevaluated for
     given dataset;
   - dataset_id: all submission for the task identified by the dataset
     are reevaluated on that dataset;
   - participation_id: all submissions for the participation are
     reevaluated on all tasks and datasets;
   - contest_id: all submissions for the contest are reevaluated, for
     all participations, tasks and datasets.

   url (function): a function that takes some URL components and
       encodes them into an URL string.
   submission_id (int|None): id of the submission to invalidate,
       or None.
   dataset_id (int|None): id of the dataset to invalidate, or
       None.
   participation_id (int|None): id of the participation to
       invalidate, or None.
   contest_id (int|None): the id of the contest containing the
       submission results to invalidate, or None not to filter
       for contest.

#}
{% if submission_id is not none and dataset_id is not none %}
  {% set invalidate_arguments = {"submission_id": submission_id,
                                 "dataset_id": dataset_id} %}
{% elif dataset_id is not none %}
  {% set invalidate_arguments = {"dataset_id": dataset_id} %}
{% elif participation_id is not none %}
  {% set invalidate_arguments = {"participation_id": participation_id} %}
{% elif contest_id is not none %}
  {% set invalidate_arguments = {"contest_id": contest_id} %}
{% endif %}
<button onclick="cmsrpc_request(
                 'EvaluationService', 0,
                 'invalidate_submission', {
{% for key, value in iteritems(invalidate_arguments) %}
                 '{{ key }}': {{ value }},
{% endfor %}
                  'level': 'compilation'},
                 function(response) { utils.redirect_if_ok('{{ next_page }}', response); }
                 );"
{% if not current_user.permission_all %}
        disabled
{% endif %}
        title="Compilation" >C</button>
<button onclick="cmsrpc_request(
                 'EvaluationService', 0,
                 'invalidate_submission', {
{% for key, value in iteritems(invalidate_arguments) %}
                 '{{ key }}': {{ value }},
{% endfor %}
                  'level': 'evaluation'},
                 function(response) { utils.redirect_if_ok('{{ next_page }}', response); }
                  );"
{% if not current_user.permission_all %}
        disabled
{% endif %}
        title="Evaluation" >E</button>
<button onclick="cmsrpc_request(
                 'ScoringService', 0,
                 'invalidate_submission', {
{% for key, value in iteritems(invalidate_arguments) %}
                 '{{ key }}': {{ value }},
{% endfor %}
                 },
                 function(response) { utils.redirect_if_ok('{{ next_page }}', response); }
                 );"
{% if not current_user.permission_all %}
        disabled
{% endif %}
        title="Score" >S</button>
{% endmacro %}
